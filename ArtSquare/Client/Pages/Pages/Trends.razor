@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Microsoft.AspNetCore.Identity;

@inject HttpClient Http
@inject IProductService ProductService
@inject NavigationManager NavManager
@inject IUserService UserService
@inject PublicClient PublicClient

@page "/trends"

<div class="parallax-container">
    <div class="background">
    </div>
    <div class="foreground">
        <div class="foreground__content">
            <form action="" method="get" class="form">
                <div class="product-search">

                    <div class="search-element2">

                        <MudText Class="">Search:</MudText>

                    </div>

                    <div class="search-element2">
                        <MudTextField Class="mb-5" FullWidth="true" @bind-Value="TextValue" Label="Title.." Variant="Variant.Text"></MudTextField>

                    </div>
                    @*<MudDivider Vertical="true" FlexItem="true" />

                    <div class="search-element2">
                        <MudSelect @bind-Value="@tagVar" Class="mb-5" T="string" Label="Tags..">
                            @foreach (var tags in PublicClient.Tags)
                            {
                                <MudSelectItem Value="@(@tags.Name)" />}
                        </MudSelect>
                    </div>*@
                    <MudDivider Vertical="true" FlexItem="true" />

                    <MudIcon @onclick="() => Search()" Class="mr-5 ml-5 " Icon="@Icons.Material.Filled.Search" Title="Search" Size="Size.Large" Color="Color.Secondary" />
                </div>
            </form>
        </div>
    </div>
</div>

<MudDivider DividerType="DividerType.Middle" Class="my-10" />

<MudText Typo="Typo.h1" Align="Align.Center">Welcome to the Marketplace</MudText>
<div class="h1">

    <div class="para">
        <MudText Typo="Typo.body1">
           Here you can discover new beautiful Art, look trough our diverse Art-Marketplace and if you find an Artpiece you love, consider buying it.<br /><br />
        <i>“There are two distinct languages. There is the verbal, which separates people… and there is the visual that is understood by everybody.”</i>
        <br><i>-Yaacov Agam</i>
        </MudText>
    </div>
</div>

<div class="h1">
    <MudText Typo="Typo.h2"> Marketplace:</MudText>

</div>

<MudGrid Class="mt-5">
    <MudItem xs="12">

        <MudGrid Spacing="@spacing" Justify="Justify.Center">
            @foreach (var product in PublicClient.Products)
            {
                if (product.IsAuction == false)
                {
                    <MudItem>

                        <MudCard Elevation="4" Width="375px" Height="450px" Square="true" Class="mr-5">

                            <MudCardHeader>
                                <CardHeaderAvatar>
                                    <MudAvatar Color="Color.Secondary">A</MudAvatar>
                                </CardHeaderAvatar>
                                <CardHeaderContent>
                                    <MudButton @onclick="() => RedirectDetailViewArtist(product.Id)" Typo="Typo.body1">@product.Artist.Firstname @product.Artist.Lastname</MudButton>
                                    <!-- <MudText Typo="Typo.body2">20/4/1969</MudText> -->
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardMedia Image=@product.ImgPath Height="200" Width="300" />
                            <MudCardContent>
                                <MudText Typo="Typo.h5">@product.Name</MudText>
                                <MudText Typo="Typo.body2">@product.Desciption</MudText>
                            </MudCardContent>
                            <MudCardActions>
                                <MudButton Variant="Variant.Text" Color="Color.Primary" @onclick="() => RedirectDetailView(product.Id)">Learn More</MudButton>
                                <MudText Class="pa-2 mr-2 mb-1 ml-auto">Buy for:</MudText>
                                <MudPaper Class="pa-2 mr-2 mb-1 ml-auto mud-theme-secondary" Square="true">@product.Price€</MudPaper>
                            </MudCardActions>
                        </MudCard>
                    </MudItem>
                }
            }



        </MudGrid>
    </MudItem>

</MudGrid>





<MudDivider DividerType="DividerType.Middle" Class="my-10" />

<div class="footer">
    <p>&copy ArtSquare - 2021</p>
</div>

@code {
    string tagVar="";
    public string TextValue { get; set; }
    public int spacing { get; set; } = 5;
    protected override async Task OnInitializedAsync()
    {
        await PublicClient.LoadProducts();
        await PublicClient.LoadTags();
    }


    void CreateUser(Dictionary<string, string>
    user)
    {


    }
    public async void Search()
    {
        var name = tagVar;

        List<Product> filter = PublicClient.Products;
        List<Product> newFilter = new List<Product>();
        if((TextValue==null || TextValue.Equals("")) && (name==null || name.Equals("")))
        {
            await PublicClient.LoadProducts();
            await PublicClient.LoadTags();
            StateHasChanged();
        }
        else if((TextValue != null && TextValue.Equals("")==false) && (name==null || name.Equals("")))
        {
            await PublicClient.LoadProducts();
            await PublicClient.LoadTags();
            filter = PublicClient.Products;
            foreach(var p in filter)
            {
                if (p.Name.Contains(TextValue))
                {
                    newFilter.Add(p);
                }
            }
            PublicClient.Products = newFilter;
            StateHasChanged();
        }
        

    }

    void AddSpacing()
    {
    if (spacing >= 10)
    {
    spacing = 0;
    }
    else
    {
    spacing += 1;
    }
    StateHasChanged();
    }

    void RedirectDetailView(int id)
    {
    NavManager.NavigateTo("/product/" + id);
    }

    void RedirectDetailViewArtist(int id)
    {
    NavManager.NavigateTo("/artistView/"+id);
    }
    }
